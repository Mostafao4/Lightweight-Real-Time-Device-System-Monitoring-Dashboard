{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
  <h1 class="mb-4">Device Dashboard</h1>

  <!-- Add Device Form -->
  <form method="post" class="row g-3 mb-4">
    <div class="col-md-4">
      <input name="name" class="form-control" placeholder="Device name" required>
    </div>
    <div class="col-md-4">
      <input name="host" class="form-control" placeholder="Host (IP or domain)" required>
    </div>
    <div class="col-md-3">
      <input name="kind" class="form-control" placeholder="Kind (server, db, etc.)" value="generic">
    </div>
    <div class="col-md-1">
      <button class="btn btn-primary w-100">Add</button>
    </div>
  </form>

  <!-- Devices Table -->
  <table class="table table-bordered table-striped align-middle">
    <thead>
      <tr>
        <th>Name</th>
        <th>Host</th>
        <th>Kind</th>
        <th>Status</th>
        <th>Latency (ms)</th>
        <th>Last Check</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for d in devices %}
      {% set cr = latest.get(d.id) %}
      <tr>
        <td>{{ d.name }}</td>
        <td>{{ d.host }}</td>
        <td>{{ d.kind }}</td>
        <td>
          {% if cr %}
            {% if cr.status == "up" %}
              <span class="badge bg-success">UP</span>
            {% elif cr.status == "degraded" %}
              <span class="badge bg-warning text-dark">DEGRADED</span>
            {% else %}
              <span class="badge bg-danger">DOWN</span>
            {% endif %}
          {% else %}
            <span class="badge bg-secondary">Unknown</span>
          {% endif %}
        </td>
        <td>{{ (cr.latency_ms ~ ' ms') if cr and cr.latency_ms is not none else '-' }}</td>
        <td>{{ cr.created_at.strftime('%Y-%m-%d %H:%M:%S') if cr else 'never' }}</td>
        <td>
          <form method="post" action="{{ url_for('routes.delete_device', device_id=d.id) }}">
            <button class="btn btn-sm btn-danger" onclick="return confirm('Delete this device?')">
              Delete
            </button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
