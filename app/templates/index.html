<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Monitoring Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Auto-refresh every 10 seconds -->
  <script>
    setTimeout(() => {
      window.location.reload();
    }, 10000); // 10000 ms = 10 seconds
  </script>
</head>
<body class="container py-4">
  <h1 class="mb-4">Device Monitoring Dashboard</h1>

  <!-- Add Device Form -->
  <form method="post" class="row g-3 mb-4">
    <div class="col-md-3">
      <input type="text" name="name" class="form-control" placeholder="Device Name" required>
    </div>
    <div class="col-md-4">
      <input type="text" name="host" class="form-control" placeholder="Host (e.g. google.com)" required>
    </div>
    <div class="col-md-3">
      <input type="text" name="kind" class="form-control" placeholder="Type (e.g. pos, printer)">
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-primary w-100">Add Device</button>
    </div>
  </form>

  <!-- Device Table -->
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Name</th>
        <th>Host</th>
        <th>Kind</th>
        <th>Status</th>
        <th>Latency (ms)</th>
        <th>Last Check</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for d in devices %}
      <tr>
        <td>{{ d.name }}</td>
        <td>{{ d.host }}</td>
        <td>{{ d.kind }}</td>
        <td>
          {% if d.results and d.results[-1].status == "up" %}
            <span class="badge bg-success">UP</span>
          {% elif d.results and d.results[-1].status == "down" %}
            <span class="badge bg-danger">DOWN</span>
          {% else %}
            <span class="badge bg-secondary">Unknown</span>
          {% endif %}
        </td>
        <td>
          {% if d.results and d.results[-1].latency_ms %}
            {{ d.results[-1].latency_ms }}
          {% else %}
            -
          {% endif %}
        </td>
        <td>
          {% if d.results %}
            {{ d.results[-1].created_at.strftime('%Y-%m-%d %H:%M:%S') }}
          {% else %}
            never
          {% endif %}
        </td>
        <td>
          <form method="post" action="{{ url_for('routes.delete_device', device_id=d.id) }}">
            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

</body>
</html>
